<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Amanda Beauty — Agendar</title>

  <style>
    :root{
      --rose: #ff69b4;
      --rose-dark: #ff3d9b;
      --bg: #faf7fb;
      --card: #ffffff;
      --muted: #666;
      --maxwidth: 1100px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: "Inter", Arial, Helvetica, sans-serif;
      background: var(--bg);
      color:#222;
    }

    /* NAV */
    .topbar{
      background:#111;
      color:#fff;
      padding:10px 20px;
    }
    .container{
      max-width: var(--maxwidth);
      margin:0 auto;
      padding:0 16px;
    }
    .nav{
      display:flex;
      align-items:center;
      justify-content:space-between;
    }
    .brand{
      display:flex;
      align-items:center;
      gap:10px;
    }
    .brand .logo{
      width:44px;height:44px;border-radius:8px;
      background:linear-gradient(135deg,var(--rose),var(--rose-dark));
      display:flex;align-items:center;justify-content:center;
      color:#fff;font-weight:700;
    }
    .menu a{
      color:#fff;text-decoration:none;
      margin-left:18px;font-weight:600;font-size:15px;
    }

    /* HERO */
    .page-hero{
      background: linear-gradient(180deg, rgba(255,214,236,0.25), transparent 60%);
      padding:28px 0;
      margin-bottom:10px;
    }
    .hero-inner{
      display:flex;
      align-items:center;
      justify-content:space-between;
    }
    .hero-title{
      font-size:22px;font-weight:700;color:#222;
    }

    /* MAIN */
    main { padding: 20px 0 80px; }
    .grid{
      display:grid;
      grid-template-columns: 1fr 420px;
      gap:28px;
      max-width: var(--maxwidth);
      margin:0 auto;
      padding:0 16px;
      align-items:start;
    }

    /* CARD */
    .card {
      background: var(--card);
      padding: 22px;
      border-radius: 12px;
      box-shadow: 0 10px 30px rgba(16,16,16,0.08);
    }
    .card h2{ margin:0 0 12px;font-size:20px;color:#111 }
    label{ display:block;margin-top:12px;font-weight:600;font-size:14px;color:var(--muted) }
    input, select{
      width:100%; padding:12px 14px; margin-top:8px;
      border-radius:10px; border:1px solid #e6e6e6;
      font-size:15px; background:#fff;
    }
    .row{ display:flex; gap:12px; }
    .row .col{ flex:1 }

    .btn{
      display:inline-block;padding:12px 16px;border-radius:10px;
      border:none;background:var(--rose);
      color:#fff;font-weight:700;cursor:pointer;
      font-size:16px;text-align:center;width:100%;
    }
    .btn.ghost{
      background:transparent;border:1px solid #ddd;
      color:#333;font-weight:600;
    }

    .small{ font-size:13px;color:var(--muted);margin-top:6px }

    /* MODAL */
    .modal-backdrop{
      position:fixed;inset:0;background:rgba(0,0,0,0.35);
      display:none;align-items:center;justify-content:center;
      z-index:60;padding:20px;
    }
    .modal{
      width:100%;max-width:520px;background:#fff;border-radius:12px;
      padding:18px;box-shadow:0 20px 40px rgba(0,0,0,0.18);
    }
    .modal h3{ margin:0 0 8px }
    .modal p{ color:var(--muted); margin:8px 0 16px }

    footer{
      margin-top:40px;background:#111;color:#fff;padding:18px 0;
    }
    footer .container{
      display:flex;justify-content:space-between;align-items:center;
    }

    @media (max-width:900px){
      .grid{ grid-template-columns: 1fr; }
      .hero-inner{ flex-direction:column; align-items:flex-start; gap:10px }
    }
  </style>
</head>
<body>

  <!-- NAV -->
  <header class="topbar">
    <div class="container nav">
      <div class="brand">
        <div class="logo">AB</div>
        <div>
          <div style="font-weight:800">Amanda Beauty</div>
          <div style="font-size:12px;color:#ddd">Estética & bem-estar</div>
        </div>
      </div>

      <nav class="menu">
        <a href="index.html">Home</a>
        <a href="servicos.html">Serviços</a>
        <a href="contato.html">Contato</a>
        <a style="text-decoration:underline" href="agenda.html">Agendar</a>
      </nav>
    </div>
  </header>

  <!-- HERO -->
  <section class="page-hero">
    <div class="container hero-inner">
      <div>
        <div class="hero-title">Agende seu horário</div>
        <div style="margin-top:6px;color:var(--muted)">
          Escolha o serviço, selecione a data e finalize com facilidade.
        </div>
      </div>
    </div>
  </section>

  <!-- MAIN -->
  <main>
    <div class="grid">

      <!-- INSTRUÇÕES -->
      <section>
        <div class="card">
          <h2>Como funciona</h2>
          <p style="color:var(--muted)">
            Escolha o serviço, a data e o horário desejado. Se o horário estiver ocupado, você será avisado imediatamente.
          </p>

          <h3 style="margin-top:16px;margin-bottom:8px">Regras Rápidas</h3>
          <ul style="margin:0 0 0 18px;color:var(--muted)">
            <li>Segunda a sábado</li>
            <li>Agendar com pelo menos 2h de antecedência</li>
            <li>Máximo de 60 dias à frente</li>
          </ul>
        </div>
      </section>

      <!-- CARD DE AGENDAR -->
      <aside>
        <div class="card">
          <h2>Agendar Horário</h2>

          <label>Serviço</label>
          <select id="servico">
            <option value="">Selecione...</option>
            <option>Limpeza de pele</option>
            <option>Peeling</option>
            <option>Botox</option>
            <option>Massagem Relaxante</option>
            <option>Sobrancelha</option>
            <option>Micropigmentação</option>
            <option>Manicure</option>
            <option>Design de cílios</option>
          </select>

          <div class="row" style="margin-top:6px">
            <div class="col">
              <label>Data</label>
              <input type="date" id="data" />
            </div>

            <div class="col">
              <label>Horário</label>
              <select id="horario"><option>Escolha a data primeiro</option></select>
            </div>
          </div>

          <label>Seu nome</label>
          <input type="text" id="nome" placeholder="Ex: Maria Silva">

          <label>Telefone</label>
          <input type="tel" id="telefone" placeholder="(11) 9xxxx-xxxx">

          <div style="margin-top:14px; display:flex; gap:10px">
            <button id="btn-confirm" class="btn">Confirmar Agendamento</button>
            <button id="btn-reset" class="btn ghost" style="width:140px">Limpar</button>
          </div>
          <div id="msg" class="small"></div>
        </div>
      </aside>
    </div>
  </main>

  <!-- MODAL -->
  <div class="modal-backdrop" id="modal">
    <div class="modal">
      <h3>Agendamento Confirmado</h3>
      <p id="modalText">Seu horário foi salvo com sucesso!</p>

      <div style="display:flex;gap:10px;justify-content:flex-end">
        <button id="btn-back-home" class="btn ghost">Voltar</button>
        <button id="btn-send-wa" class="btn">Enviar WhatsApp</button>
      </div>
    </div>
  </div>

  <!-- FOOTER -->
  <footer>
    <div class="container">
      <div>© <strong>Amanda Beauty</strong> — Todos os direitos reservados</div>
      <div style="font-size:13px;color:#ddd">
        Sorocaba — SP
      </div>
    </div>
  </footer>

  <!-- SCRIPT -->
  <script type="module">

    // ELEMENTOS
    const servico = document.getElementById('servico');
    const dataInput = document.getElementById('data');
    const horarioSelect = document.getElementById('horario');
    const nomeInput = document.getElementById('nome');
    const telInput = document.getElementById('telefone');

    const msgBox = document.getElementById('msg');
    const btnConfirm = document.getElementById('btn-confirm');
    const btnReset = document.getElementById('btn-reset');

    const modal = document.getElementById('modal');
    const modalText = document.getElementById('modalText');
    const btnBackHome = document.getElementById('btn-back-home');
    const btnSendWa = document.getElementById('btn-send-wa');

    const horariosFixos = ["08:00","09:00","10:00","13:00","14:00","15:00","16:00"];

    const MIN_AHEAD = 2;     // horas
    const MAX_DIAS = 60;     // dias

    const phoneAmanda = "5511988802349";

    function cleanPhone(str){ return (str||"").replace(/\D/g,""); }

    // Preenche horários ao selecionar data
    dataInput.addEventListener('change', () => {
      horarioSelect.innerHTML = '';

      if (!dataInput.value) {
        horarioSelect.innerHTML = '<option>Escolha a data primeiro</option>';
        return;
      }

      horariosFixos.forEach(h => {
        const o = document.createElement('option');
        o.value = h;
        o.textContent = h;
        horarioSelect.appendChild(o);
      });
    });

    // Limpar
    btnReset.onclick = () => {
      servico.value = '';
      dataInput.value = '';
      horarioSelect.innerHTML = '<option>Escolha a data primeiro</option>';
      nomeInput.value = '';
      telInput.value = '';
      msgBox.textContent = '';
    };

    // Checar horário ocupado (localStorage)
    function horarioOcupado(dataISO, hora) {
      const raw = localStorage.getItem('agendamentos_demo');
      if (!raw) return false;

      const arr = JSON.parse(raw);
      return arr.some(a => a.data === dataISO && a.hora === hora);
    }

    // Salvar agendamento (localStorage)
    function salvarLocal(obj) {
      const raw = localStorage.getItem('agendamentos_demo');
      const arr = raw ? JSON.parse(raw) : [];
      arr.push(obj);
      localStorage.setItem('agendamentos_demo', JSON.stringify(arr));
    }

    // CONFIRMAR AGENDAMENTO
    btnConfirm.onclick = () => {
      msgBox.textContent = '';

      const s = servico.value;
      const d = dataInput.value;
      const h = horarioSelect.value;
      const n = nomeInput.value.trim();
      const t = cleanPhone(telInput.value);

      if (!s || !d || !h || !n || !t) {
        msgBox.textContent = "Preencha todos os campos!";
        return;
      }

      if (t.length < 10) {
        msgBox.textContent = "Telefone inválido!";
        return;
      }

      // validações de horário
      const agora = new Date();
      const [hh, mm] = h.split(':').map(Number);
      const agendar = new Date(`${d}T${h}:00`);

      // antecedência mínima
      const diffHoras = (agendar - agora) / (1000*60*60);
      if (diffHoras < MIN_AHEAD) {
        msgBox.textContent = "Agende com pelo menos 2 horas de antecedência.";
        return;
      }

      // limite máximo
      const maxData = new Date(agora.getTime() + MAX_DIAS*24*60*60*1000);
      if (agendar > maxData) {
        msgBox.textContent = `Você só pode agendar até ${MAX_DIAS} dias à frente.`;
        return;
      }

      // horário ocupado
      if (horarioOcupado(d, h)) {
        msgBox.textContent = "Este horário já está ocupado!";
        return;
      }

      // salvar
      const ag = {
        id: Date.now(),
        servico: s,
        data: d,
        hora: h,
        nome: n.toUpperCase(),
        telefone: t,
        criadoEm: new Date().toISOString()
      };

      salvarLocal(ag);

      // abrir modal
      modalText.textContent =
        `Pronto, ${n}! Seu horário de ${s} em ${d} às ${h} foi registrado.`;

      modal.style.display = 'flex';

      // WhatsApp
      const msg = encodeURIComponent(
        `Olá Amanda! Acabei de agendar *${s}* no dia ${d} às ${h}. Meu nome é ${n} e meu telefone é ${t}.`
      );

      btnSendWa.onclick = () => {
        window.open(`https://wa.me/${phoneAmanda}?text=${msg}`, '_blank');
      };

      btnBackHome.onclick = () => {
        modal.style.display = 'none';
        btnReset.click();
      };
    };

    // fechar clicando fora
    modal.onclick = (e) => {
      if (e.target === modal) modal.style.display = 'none';
    };

  </script>
</body>
</html>
