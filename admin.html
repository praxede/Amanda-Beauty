<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Painel Administrativo - Amanda Beauty</title>

  <!-- estilo global rosé -->
  <link rel="stylesheet" href="global.css">

  <style>
    /* Ajuste visual específico do painel */
    .admin-card {
      background: #fff;
      padding: 25px;
      border-radius: 10px;
      box-shadow: 0 4px 14px rgba(0,0,0,.08);
      margin-bottom: 40px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }

    th, td {
      padding: 12px;
      border: 1px solid #e5e5e5;
      text-align: center;
    }

    th {
      background: #ff69b4;
      color: white;
      text-align: center;
    }

    button {
      padding: 7px 12px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      color: white;
      font-size: 14px;
    }

    .confirmar { background: #28a745; }
    .atendido  { background: #007bff; }
    .falta     { background: #dc3545; }
  </style>

</head>
<body>

  <!-- HEADER -->
  <header class="site-header">
    <a href="index.html" class="logo">Amanda Beauty</a>
  </header>

  <!-- NAV -->
  <nav>
    <a href="index.html">Home</a>
    <a href="quem-somos.html">Quem Sou</a>
    <a href="servicos.html">Serviços</a>
    <a href="contato.html">Contato</a>
    <a href="como-chegar.html">Como chegar</a>
    <a href="admin.html">Admin</a>
  </nav>

  <!-- CONTEÚDO -->
  <main class="page">
    <div class="site-container">

      <article class="admin-card fade-in-up">
        <h1 class="page-title">Painel Administrativo</h1>

        <p class="lead">Selecione uma data para visualizar os horários agendados.</p>

        <label>Escolher data:</label>
        <br>
        <input type="date" id="data" style="padding:10px; width:220px; margin-top:8px;">

        <table>
          <thead>
            <tr>
              <th>Hora</th>
              <th>Cliente</th>
              <th>Serviço</th>
              <th>Status</th>
              <th>Ações</th>
            </tr>
          </thead>
          <tbody id="lista"></tbody>
        </table>

      </article>

    </div>
  </main>

  <!-- RODAPÉ -->
  <div id="footer"></div>
  <script>
    fetch("footer.html")
      .then(res => res.text())
      .then(html => document.getElementById("footer").innerHTML = html);
  </script>


  <!-- FIREBASE + FIRESTORE -->
  <script type="module">
    import { db } from "./firebase-config.js";
    import {
      collection, query, where, onSnapshot, doc, updateDoc
    } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

    const dataInput = document.getElementById("data");
    const lista = document.getElementById("lista");

    // Função para formatar o telefone
    function formatarTelefone(t) {
      if (!t) return "";
      t = t.toString().replace(/\D/g, "");
      return `(${t.slice(0,2)}) ${t.slice(2,7)}-${t.slice(7)}`;
    }

    // Quando escolher uma data → carregar agendamentos
    dataInput.addEventListener("change", () => {
      carregarAgenda(dataInput.value);
    });

    function carregarAgenda(dataEscolhida) {
      lista.innerHTML = "<tr><td colspan='5'>Carregando...</td></tr>";

      const agRef = collection(db, "agendamentos");
      const q = query(agRef, where("data", "==", dataEscolhida));

      onSnapshot(q, (snap) => {
        lista.innerHTML = "";

        if (snap.empty) {
          lista.innerHTML = "<tr><td colspan='5'>Nenhum agendamento encontrado</td></tr>";
          return;
        }

        snap.forEach((docItem) => {
          const a = docItem.data();

          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td>${a.hora}</td>
            <td>${a.nome} <br> <small>${formatarTelefone(a.telefone)}</small></td>
            <td>${a.servico}</td>
            <td>${a.status}</td>
            <td>
              <button class="confirmar">Confirmar</button>
              <button class="atendido">Atendido</button>
              <button class="falta">Falta</button>
            </td>
          `;

          tr.querySelector(".confirmar").onclick = () => atualizar(docItem.id, "Confirmado");
          tr.querySelector(".atendido").onclick = () => atualizar(docItem.id, "Atendido");
          tr.querySelector(".falta").onclick = () => atualizar(docItem.id, "Falta");

          lista.appendChild(tr);
        });
      });
    }

    async function atualizar(id, status) {
      const ref = doc(db, "agendamentos", id);
      await updateDoc(ref, { status });

      alert("Status atualizado!");
    }
  </script>

</body>
</html>
